(this["webpackJsonpmyLibrary"]=this["webpackJsonpmyLibrary"]||[]).push([["chunk-78a36981"],{"27d5":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dify-chat"},[n("div",{staticClass:"chat-header"},[n("div",{staticClass:"header-left"},[n("el-button",{attrs:{icon:"el-icon-arrow-left",size:"small"},on:{click:t.goBack}},[t._v("返回")]),n("h3",[t._v(t._s(t.chatTitle))])],1)]),n("div",{ref:"chatHistoryRef",staticClass:"chat-history"},t._l(t.messages,(function(e){return n("div",{key:e.id,class:["message-item",e.role]},[n("span",{staticClass:"role-label"},[t._v(t._s("user"===e.role?"我":"AI")+"：")]),n("div",{staticClass:"message-content",domProps:{innerHTML:t._s(t.renderMessage(e.content))}})])})),0),n("div",{staticClass:"chat-input"},[n("div",{staticClass:"input-container"},[n("el-input",{ref:"inputRef",staticClass:"chat-textarea",attrs:{placeholder:"请输入你的问题 (Enter 发送，Ctrl+Enter 换行)",clearable:"",type:"textarea",rows:t.inputRows,maxlength:1e3,"show-word-limit":"",resize:"none",disabled:t.loading},on:{input:t.handleInput},nativeOn:{keydown:function(e){return t.handleKeydown(e)}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),n("div",{staticClass:"input-actions"},[n("el-button",{staticClass:"send-btn",attrs:{type:"primary",loading:t.loading,size:"medium",disabled:!t.input.trim()},on:{click:t.sendMessage}},[n("i",{staticClass:"el-icon-s-promotion"}),t._v(" 发送 ")])],1)],1)])])},a=[],s=n("c14f"),o=n("1da1"),i=(n("7db0"),n("14d9"),n("d3b7"),n("498a"),n("0643"),n("fffc"),n("af84")),c=n("7c5c"),u={ecircuit:"app-afkfBEWGtMWAEQfCRzkPva64",circuit:"app-AbJMJlJW3fiph9QF2H9N2Pym"},l="app-J4y46SO9GtwtjADyLAOj9tzL",p={name:"DifyChat",data:function(){return{input:"",messages:[],loading:!1,chatType:"main",inputRows:3,minRows:3,maxRows:8}},computed:{chatTitle:function(){var t={main:"电子信息课程综合问答",circuit:"电路分析基础",ecircuit:"电子电路基础",signal:"信号与系统",microwave:"电磁场微波技术",communication:"通信原理",dsp:"数字信号处理",microelectronics:"微电子技术",admission:"招生咨询","job-info":"招聘信息","resume-opt":"简历优化","paper-topic":"论文选题","proposal-opt":"开题报告优化","paper-writing":"论文撰写"};return t[this.chatType]||"智能问答"}},mounted:function(){var t=this;this.$nextTick((function(){t.focusInput()}))},created:function(){this.chatType=this.$route.query.type||"main",this.messages.push({id:Date.now(),role:"assistant",content:"你好！我是 **".concat(this.chatTitle,"** 领域的 AI 助手，有什么可以帮助你的吗？")})},methods:{focusInput:function(){this.$refs.inputRef&&this.$refs.inputRef.focus()},goBack:function(){this.$router.push("/tool/smart-qa")},scrollToBottom:function(){var t=this;return Object(o["a"])(Object(s["a"])().m((function e(){var n;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:return e.n=1,t.$nextTick();case 1:n=t.$refs.chatHistoryRef,n&&(n.scrollTop=n.scrollHeight);case 2:return e.a(2)}}),e)})))()},handleKeydown:function(t){if("Enter"===t.key){if(t.ctrlKey)return;t.preventDefault(),this.sendMessage()}},handleInput:function(){var t=this.input.split("\n").length,e=Math.max(this.minRows,Math.min(this.maxRows,t));e!==this.inputRows&&(this.inputRows=e)},sendMessage:function(){var t=this;return Object(o["a"])(Object(s["a"])().m((function e(){var n,r,a;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(t.input.trim()&&!t.loading){e.n=1;break}return e.a(2);case 1:return n=t.input,t.messages.push({role:"user",content:n,id:Date.now()}),t.input="",t.inputRows=t.minRows,t.scrollToBottom(),t.loading=!0,r=Date.now()+1,t.messages.push({role:"assistant",content:"...",id:r}),t.scrollToBottom(),a=u[t.chatType]||l,e.n=2,Object(i["a"])(n,{onMessage:function(e){var n=t.messages.find((function(t){return t.id===r}));n&&("..."===n.content?n.content=e:n.content+=e,t.scrollToBottom())},onDone:function(){t.loading=!1,console.log("Stream finished."),t.$nextTick((function(){t.focusInput()}))},onError:function(e){var n=t.messages.find((function(t){return t.id===r}));n&&(n.content="AI 服务异常: "+e.message),t.loading=!1,console.error("Dify API error:",e),t.$nextTick((function(){t.focusInput()}))}},a);case 2:return e.a(2)}}),e)})))()},renderMessage:function(t){return t?c["marked"].parse(t,{gfm:!0,breaks:!0}):""}}},d=p,f=(n("7089"),n("2877")),h=Object(f["a"])(d,r,a,!1,null,"3d547707",null);e["default"]=h.exports},"4e76":function(t,e,n){},7089:function(t,e,n){"use strict";n("4e76")},af84:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"c",(function(){return d})),n.d(e,"f",(function(){return h})),n.d(e,"d",(function(){return w}));var r=n("c14f"),a=n("b85c"),s=n("1da1");n("d9e2"),n("99af"),n("e9c4"),n("b64b"),n("d3b7"),n("2ca0"),n("498a");function o(t,e){return i.apply(this,arguments)}function i(){return i=Object(s["a"])(Object(r["a"])().m((function t(e,n){var s,o,i,c,u,l,p,d,f,h,m,w,b,v,y,g,k,O,j,T,_,x,P,S,z=arguments;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return s=n.onMessage,o=n.onDone,i=n.onError,c=z.length>2&&void 0!==z[2]?z[2]:"app-J4y46SO9GtwtjADyLAOj9tzL",u="http://101.43.162.190:8088/v1/chat-messages",l={inputs:{},query:e,response_mode:"streaming",user:"user"},p={Authorization:"Bearer ".concat(c),"Content-Type":"application/json"},t.p=1,t.n=2,fetch(u,{method:"POST",headers:p,body:JSON.stringify(l)});case 2:if(d=t.v,d.ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(d.status));case 3:f=d.body.getReader(),h=new TextDecoder("utf-8"),m="";case 4:return t.n=5,f.read();case 5:if(w=t.v,b=w.done,v=w.value,!b){t.n=6;break}return console.log("Stream finished."),o&&o(),t.a(3,17);case 6:y=m+h.decode(v,{stream:!0}),g=y.split("\n"),m=g.pop()||"",k=Object(a["a"])(g),t.p=7,k.s();case 8:if((O=k.n()).done){t.n=13;break}if(j=O.value,j.startsWith("data:")){t.n=9;break}return t.a(3,12);case 9:if(t.p=9,T=j.substring(6),"[DONE]"!==T.trim()){t.n=10;break}return t.a(3,12);case 10:_=JSON.parse(T),"message"===_.event&&_.answer&&s&&s(_.answer),t.n=12;break;case 11:t.p=11,x=t.v,console.error("Failed to parse JSON from line:",j,x);case 12:t.n=8;break;case 13:t.n=15;break;case 14:t.p=14,P=t.v,k.e(P);case 15:return t.p=15,k.f(),t.f(15);case 16:t.n=4;break;case 17:t.n=19;break;case 18:t.p=18,S=t.v,console.error("Streaming failed:",S),i&&i(S);case 19:return t.a(2)}}),t,null,[[9,11],[7,14,15,16],[1,18]])}))),i.apply(this,arguments)}function c(t){return u.apply(this,arguments)}function u(){return u=Object(s["a"])(Object(r["a"])().m((function t(e){var n,a,s,o,i,c,u;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return n="http://101.43.162.190:8088/v1/workflows/run",a="app-n1JVzEVSjlnzr7PXVdzMYtdy",s={inputs:{chapter:e},response_mode:"blocking",user:"lesson-user"},o={Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},t.p=1,t.n=2,fetch(n,{method:"POST",headers:o,body:JSON.stringify(s)});case 2:if(i=t.v,i.ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(i.status));case 3:return t.n=4,i.json();case 4:return c=t.v,t.a(2,c);case 5:throw t.p=5,u=t.v,u;case 6:return t.a(2)}}),t,null,[[1,5]])}))),u.apply(this,arguments)}function l(t){return p.apply(this,arguments)}function p(){return p=Object(s["a"])(Object(r["a"])().m((function t(e){var n,a,s,o,i,c,u,l=arguments;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:"app-bS8Qyzd7klGSkVvhbc2rlBs3",a="http://101.43.162.190:8088/v1/files/upload",s={Authorization:"Bearer ".concat(n)},o=new FormData,o.append("file",e),o.append("user","abc-123"),t.p=1,t.n=2,fetch(a,{method:"POST",headers:s,body:o});case 2:if(i=t.v,i.ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(i.status));case 3:return t.n=4,i.json();case 4:return c=t.v,t.a(2,c.id);case 5:throw t.p=5,u=t.v,console.error("File upload failed:",u),u;case 6:return t.a(2)}}),t,null,[[1,5]])}))),p.apply(this,arguments)}function d(t){return f.apply(this,arguments)}function f(){return f=Object(s["a"])(Object(r["a"])().m((function t(e){var n,a,s,o,i,c,u,l,p,d=arguments;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:"circuit",a=d.length>2&&void 0!==d[2]?d[2]:"app-bS8Qyzd7klGSkVvhbc2rlBs3",s="http://101.43.162.190:8088/v1/workflows/run",o={inputs:{courseName:n,examFile:{type:"document",transfer_method:"local_file",upload_file_id:e}},response_mode:"blocking",user:"abc-124"},i={Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},t.p=1,t.n=2,fetch(s,{method:"POST",headers:i,body:JSON.stringify(o)});case 2:if(c=t.v,c.ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(c.status));case 3:return t.n=4,c.json();case 4:return u=t.v,l="",u.data&&u.data.workflow_run_id&&u.data.workflow_run_id.outputs?l=u.data.workflow_run_id.outputs.text||"":u.data&&u.data.outputs?l=u.data.outputs.text||"":u.outputs&&(l=u.outputs.text||""),t.a(2,{success:!0,text:l,rawData:u});case 5:throw t.p=5,p=t.v,console.error("Exam analysis failed:",p),p;case 6:return t.a(2)}}),t,null,[[1,5]])}))),f.apply(this,arguments)}function h(t){return m.apply(this,arguments)}function m(){return m=Object(s["a"])(Object(r["a"])().m((function t(e){var n,a,s,o,i,c,u,l,p,d=arguments;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:"app-PMBbbHxJePSgvz2XPPytjEre",a="http://43.140.245.165:8993/v1/files/upload",s=new FormData,s.append("file",e),s.append("user","zxr"),t.p=1,t.n=2,fetch(a,{method:"POST",headers:{Authorization:"Bearer ".concat(n)},body:s});case 2:if(c=t.v,c.ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(c.status));case 3:return t.n=4,c.json();case 4:if(u=t.v,console.log("Upload response:",u),l=u.id||u.file_id||(null===(o=u.data)||void 0===o?void 0:o.id)||(null===(i=u.data)||void 0===i?void 0:i.file_id)||"",l){t.n=5;break}throw console.error("Upload response data:",u),new Error("上传失败：未返回文件ID");case 5:return t.a(2,l);case 6:throw t.p=6,p=t.v,console.error("Resume file upload failed:",p),p;case 7:return t.a(2)}}),t,null,[[1,6]])}))),m.apply(this,arguments)}function w(t,e){return b.apply(this,arguments)}function b(){return b=Object(s["a"])(Object(r["a"])().m((function t(e,n){var a,s,o,i,c,u,l,p,d,f=arguments;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return a=f.length>2&&void 0!==f[2]?f[2]:"app-PMBbbHxJePSgvz2XPPytjEre",s="http://43.140.245.165:8993/v1/workflows/run",o={inputs:{resume_file:{transfer_method:"local_file",upload_file_id:e,type:"document"},job_description:n},response_mode:"blocking",user:"zxr"},i={Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},t.p=1,console.log("Optimize request payload:",JSON.stringify(o,null,2)),console.log("File ID:",e),t.n=2,fetch(s,{method:"POST",headers:i,body:JSON.stringify(o)});case 2:if(c=t.v,c.ok){t.n=4;break}return t.n=3,c.text();case 3:throw u=t.v,console.error("Optimize error response:",u),new Error("HTTP error! status: ".concat(c.status,", message: ").concat(u));case 4:return t.n=5,c.json();case 5:return l=t.v,p="",l.data&&l.data.workflow_run_id&&l.data.workflow_run_id.outputs?p=l.data.workflow_run_id.outputs.text||l.data.workflow_run_id.outputs.result||"":l.data&&l.data.outputs?p=l.data.outputs.text||l.data.outputs.result||"":l.outputs?p=l.outputs.text||l.outputs.result||"":l.result&&(p=l.result),t.a(2,{success:!0,text:p,rawData:l});case 6:throw t.p=6,d=t.v,console.error("Resume optimization failed:",d),d;case 7:return t.a(2)}}),t,null,[[1,6]])}))),b.apply(this,arguments)}}}]);