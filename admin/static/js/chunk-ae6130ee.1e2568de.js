(this["webpackJsonpmyLibrary"]=this["webpackJsonpmyLibrary"]||[]).push([["chunk-ae6130ee"],{2267:function(e,t,s){},"3eec":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"search-section"},[s("h2",{staticClass:"section-title"},[e._v("聊天记录管理")]),s("el-form",{ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"聊天ID",prop:"ltId"}},[s("el-input",{attrs:{placeholder:"输入聊天ID查看完整对话",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.ltId,callback:function(t){e.$set(e.queryParams,"ltId",t)},expression:"queryParams.ltId"}},[s("el-tooltip",{attrs:{slot:"suffix",content:"输入聊天ID以查看完整对话上下文",placement:"top"},slot:"suffix"},[s("i",{staticClass:"el-icon-info"})])],1)],1),s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{attrs:{placeholder:"请输入用户名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.userName,callback:function(t){e.$set(e.queryParams,"userName",t)},expression:"queryParams.userName"}},[s("el-tooltip",{attrs:{slot:"suffix",content:"输入学工号以查询对话记录",placement:"top"},slot:"suffix"},[s("i",{staticClass:"el-icon-info"})])],1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}},[e._v("搜索")]),s("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1)],1),s("div",{staticClass:"view-control-section"},[s("div",{staticClass:"view-mode-tabs"},[s("div",{staticClass:"view-tab",class:{active:"card"===e.viewMode},on:{click:function(t){e.viewMode="card"}}},[s("i",{staticClass:"el-icon-s-grid"}),e._v(" 卡片视图 ")]),s("div",{staticClass:"view-tab",class:{active:"chat"===e.viewMode},on:{click:function(t){e.viewMode="chat"}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),e._v(" 对话视图 ")])]),e.isSearchActive?s("div",{staticClass:"search-result"},[s("el-tag",{attrs:{type:"info",effect:"plain",size:"medium"}},[e.queryParams.ltId?[e._v(" 聊天ID: "),s("b",[e._v(e._s(e.queryParams.ltId))])]:e._e(),e.queryParams.role?[e._v(" 归属方: "),s("b",[e._v(e._s(e.getRoleName(e.queryParams.role)))])]:e._e(),e.queryParams.userName?[e._v(" 用户名: "),s("b",[e._v(e._s(e.queryParams.userName))])]:e._e(),[e._v(" 共 "),s("b",[e._v(e._s(e.total))]),e._v(" 条记录 ")],s("i",{staticClass:"el-icon-close close-icon",on:{click:e.resetQuery}})],2)],1):e._e()]),"card"===e.viewMode?s("div",{staticClass:"card-view"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"cards-container",attrs:{"element-loading-text":"加载中...","infinite-scroll-disabled":e.infiniteScrollDisabled,"infinite-scroll-distance":10}},[s("div",{staticClass:"masonry-layout"},e._l(e.xxList,(function(t){return s("div",{key:t.xxId,staticClass:"card-wrapper",class:{highlight:e.queryParams.ltId===t.ltId}},[s("div",{staticClass:"message-card",on:{click:function(s){return e.openDetailDialog(t)}}},[s("div",{staticClass:"card-header"},[s("span",{staticClass:"chat-id",on:{click:function(s){return s.stopPropagation(),e.showContextMessages(t.ltId)}}},[e._v("#"+e._s(t.ltId))]),s("el-tag",{staticClass:"role-tag",attrs:{size:"mini",type:e.roleTagType(t.role)}},[e._v(" "+e._s(e.getRoleName(t.role))+" ")]),"user"===t.role&&t.userName?s("span",{staticClass:"user-name"},[e._v(e._s(t.userName))]):e._e()],1),s("div",{staticClass:"card-body"},[s("div",{staticClass:"message-content"},[e._v(e._s(t.xxContent))])]),s("div",{staticClass:"card-footer"},[s("span",{staticClass:"time"},[e._v(e._s(e.formatTime(t.createTime)))]),s("el-button",{staticClass:"context-btn",attrs:{type:"text",size:"mini"},on:{click:function(s){return s.stopPropagation(),e.showContextMessages(t.ltId)}}},[s("i",{staticClass:"el-icon-view"}),e._v(" 上下文 ")])],1)])])})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:e.xxList.length>0,expression:"xxList.length > 0"}],staticClass:"load-more-status"},[e.loading&&!e.firstLoad?s("p",[e._v("加载中...")]):e.hasReachedEnd?s("p",[e._v("没有更多数据了")]):s("p",[e._v("继续滚动加载更多")])])])]):e._e(),"chat"===e.viewMode?s("div",{staticClass:"chat-view"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"chat-container",attrs:{"element-loading-text":"加载中...","infinite-scroll-disabled":e.infiniteScrollDisabled,"infinite-scroll-distance":10}},[s("div",{staticClass:"message-timeline"},e._l(e.xxList,(function(t){return s("div",{key:t.xxId,staticClass:"timeline-message",class:[t.role,{highlight:e.queryParams.ltId===t.ltId}]},[s("div",{staticClass:"message-info"},[s("span",{staticClass:"message-id"},[e._v("#"+e._s(t.xxId))]),s("span",{staticClass:"chat-id",on:{click:function(s){return e.showContextMessages(t.ltId)}}},[e._v(" 对话: #"+e._s(t.ltId)+" ")]),s("el-tag",{attrs:{size:"mini",type:e.roleTagType(t.role)}},[e._v(" "+e._s(e.getRoleName(t.role))+" ")]),"user"===t.role&&t.userName?s("span",{staticClass:"user-name"},[s("i",{staticClass:"el-icon-user"}),e._v(" "+e._s(t.userName)+" ")]):e._e(),s("span",{staticClass:"time"},[e._v(e._s(e.formatTime(t.createTime)))])],1),s("div",{staticClass:"message-bubble",on:{click:function(s){return e.openDetailDialog(t)}}},[e._v(" "+e._s(t.xxContent)+" ")]),s("div",{staticClass:"message-actions"},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){return e.showContextMessages(t.ltId)}}},[s("i",{staticClass:"el-icon-view"}),e._v(" 查看对话上下文 ")])],1)])})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:e.xxList.length>0,expression:"xxList.length > 0"}],staticClass:"load-more-status"},[e.loading&&!e.firstLoad?s("p",[e._v("加载中...")]):e.hasReachedEnd?s("p",[e._v("没有更多数据了")]):s("p",[e._v("继续滚动加载更多")])])])]):e._e(),0!==e.xxList.length||e.loading?e._e():s("div",{staticClass:"no-data"},[s("el-empty",{attrs:{description:"暂无聊天记录","image-size":100}})],1),s("el-dialog",{attrs:{title:"消息详情",visible:e.detailDialogVisible,width:"700px","custom-class":"detail-dialog","close-on-click-modal":!0,"append-to-body":""},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[e.currentDetail?s("div",{staticClass:"detail-container"},[s("div",{staticClass:"detail-header"},[s("div",{staticClass:"meta-info"},[s("div",{staticClass:"meta-item"},[s("label",[e._v("消息ID:")]),s("span",[e._v(e._s(e.currentDetail.xxId))])]),s("div",{staticClass:"meta-item"},[s("label",[e._v("聊天ID:")]),s("span",[e._v(e._s(e.currentDetail.ltId))])]),s("div",{staticClass:"meta-item"},[s("label",[e._v("归属方:")]),s("el-tag",{attrs:{size:"small",type:e.roleTagType(e.currentDetail.role)}},[e._v(" "+e._s(e.getRoleName(e.currentDetail.role))+" ")])],1),"user"===e.currentDetail.role&&e.currentDetail.userName?s("div",{staticClass:"meta-item"},[s("label",[e._v("用户名:")]),s("span",[e._v(e._s(e.currentDetail.userName))])]):e._e(),s("div",{staticClass:"meta-item"},[s("label",[e._v("时间:")]),s("span",[e._v(e._s(e.currentDetail.createTime))])])]),s("div",{staticClass:"detail-actions"},[s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-chat-dot-round"},on:{click:e.switchToContextView}},[e._v("查看对话上下文")])],1)]),s("div",{staticClass:"detail-content"},[s("h4",[e._v("消息内容")]),s("div",{staticClass:"content-box"},[e._v(e._s(e.currentDetail.xxContent))])])]):e._e(),s("div",{staticClass:"detail-footer"},[s("el-button",{on:{click:function(t){e.detailDialogVisible=!1}}},[e._v("关闭")])],1)]),s("el-dialog",{attrs:{title:"对话上下文",visible:e.contextDialogVisible,width:"800px","custom-class":"context-dialog","close-on-click-modal":!0,"append-to-body":""},on:{"update:visible":function(t){e.contextDialogVisible=t}}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.contextLoading,expression:"contextLoading"}],staticClass:"context-container"},[s("div",{staticClass:"context-header"},[s("div",{staticClass:"context-info"},[s("span",{staticClass:"chat-id"},[e._v("聊天ID: "+e._s(e.currentContextId))]),s("span",{staticClass:"message-count"},[e._v("共 "+e._s(e.contextMessages.length)+" 条消息")])])]),s("div",{staticClass:"message-timeline"},e._l(e.contextMessages,(function(t){return s("div",{key:t.xxId,staticClass:"timeline-message",class:[t.role,{current:t.xxId===e.currentMessageId}]},[s("div",{staticClass:"message-header"},[s("span",{staticClass:"message-role"},[e._v(e._s(e.getRoleName(t.role)))]),"user"===t.role&&t.userName?s("span",{staticClass:"message-user"},[s("i",{staticClass:"el-icon-user"}),e._v(" "+e._s(t.userName)+" ")]):e._e(),s("span",{staticClass:"message-time"},[e._v(e._s(e.formatTime(t.createTime)))])]),s("div",{staticClass:"message-body"},[e._v(" "+e._s(t.xxContent)+" ")])])})),0),0!==e.contextMessages.length||e.contextLoading?e._e():s("div",{staticClass:"no-context"},[s("el-empty",{attrs:{description:"未找到相关对话","image-size":100}})],1)]),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.contextDialogVisible=!1}}},[e._v("关闭")]),s("el-button",{attrs:{type:"primary"},on:{click:e.switchToMainContextView}},[e._v("在主视图中查看")])],1)])],1)},i=[],l=s("2909"),n=(s("99af"),s("b775"));function o(e){return Object(n["a"])({url:"/system/xx/list",method:"get",params:e})}var r={name:"Xx",data:function(){return{loading:!0,firstLoad:!0,total:0,xxList:[],viewMode:"card",detailDialogVisible:!1,currentDetail:null,contextDialogVisible:!1,contextLoading:!1,contextMessages:[],currentContextId:null,currentMessageId:null,hasReachedEnd:!1,queryParams:{pageNum:1,pageSize:12,xxContent:null,ltId:null,role:null,userName:null}}},computed:{isSearchActive:function(){return this.queryParams.ltId||this.queryParams.role||this.queryParams.userName},infiniteScrollDisabled:function(){return this.loading||this.hasReachedEnd}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,this.firstLoad=!1,o(this.queryParams).then((function(t){1===e.queryParams.pageNum?e.xxList=t.rows:e.xxList=[].concat(Object(l["a"])(e.xxList),Object(l["a"])(t.rows)),e.total=t.total,e.loading=!1,e.hasReachedEnd=e.xxList.length>=e.total}))},loadMore:function(){this.loading||this.hasReachedEnd||(this.queryParams.pageNum+=1,this.getList())},formatTime:function(e){if(!e)return"";var t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},openDetailDialog:function(e){this.currentDetail=e,this.detailDialogVisible=!0},switchToContextView:function(){this.currentDetail&&this.showContextMessages(this.currentDetail.ltId,this.currentDetail.xxId),this.detailDialogVisible=!1},switchToMainContextView:function(){this.contextDialogVisible=!1,this.showContextMessages(this.currentContextId)},showContextMessages:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t?(this.contextDialogVisible=!0,this.contextLoading=!0,this.currentContextId=e,this.currentMessageId=t,this.getContextMessages(e)):(this.queryParams.ltId=e,this.queryParams.role=null,this.queryParams.pageNum=1,this.hasReachedEnd=!1,this.getList())},getContextMessages:function(e){var t=this,s={ltId:e,pageSize:100};o(s).then((function(e){t.contextMessages=e.rows,t.contextLoading=!1})).catch((function(){t.contextLoading=!1,t.$message.error("获取上下文消息失败")}))},getRoleName:function(e){var t={user:"用户",system:"系统",admin:"管理员"};return t[e]||e},roleTagType:function(e){var t={user:"",system:"success",admin:"warning"};return t[e]||"info"},handleQuery:function(){this.queryParams.pageNum=1,this.hasReachedEnd=!1,this.getList()},resetQuery:function(){this.queryParams.ltId=null,this.queryParams.role=null,this.queryParams.userName=null,this.queryParams.pageNum=1,this.hasReachedEnd=!1,this.handleQuery()}}},c=r,d=(s("9a8a"),s("2877")),u=Object(d["a"])(c,a,i,!1,null,"bf07b17e",null);t["default"]=u.exports},"9a8a":function(e,t,s){"use strict";s("2267")}}]);