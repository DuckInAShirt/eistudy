(this["webpackJsonpmyLibrary"]=this["webpackJsonpmyLibrary"]||[]).push([["chunk-59a6ade6"],{"167a":function(e,t,r){"use strict";r("44b6")},"44b6":function(e,t,r){},"58e5":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"exam-analysis-container"},[r("h2",[e._v("试卷分析")]),r("el-card",{staticClass:"upload-card"},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("上传试卷文件")])]),r("el-form",{attrs:{model:e.form,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"课程选择"}},[r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择课程"},model:{value:e.form.courseName,callback:function(t){e.$set(e.form,"courseName",t)},expression:"form.courseName"}},[r("el-option",{attrs:{label:"电路分析基础",value:"circuit"}}),r("el-option",{attrs:{label:"电子电路基础",value:"ecircuit"}}),r("el-option",{attrs:{label:"信号与系统",value:"signal"}}),r("el-option",{attrs:{label:"电磁场微波技术",value:"microwave"}}),r("el-option",{attrs:{label:"通信原理",value:"communication"}}),r("el-option",{attrs:{label:"数字信号处理",value:"dsp"}}),r("el-option",{attrs:{label:"微电子技术",value:"microelectronics"}})],1)],1),r("el-form-item",{attrs:{label:"试卷文件"}},[r("el-upload",{ref:"upload",staticStyle:{width:"100%"},attrs:{action:null,"auto-upload":!1,"on-change":e.handleFileChange,"before-upload":e.beforeUpload,"file-list":e.fileList,accept:".doc,.docx,.pdf,.txt",drag:""}},[r("i",{staticClass:"el-icon-upload"}),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),r("em",[e._v("点击上传")])]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 支持 .doc, .docx, .pdf, .txt 格式文件，文件大小不超过 10MB ")])])],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.form.file||!e.form.courseName},on:{click:e.analyzeExam}},[e._v(" 开始分析 ")]),r("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1),e.result?r("el-card",{staticClass:"result-card"},[r("div",{staticClass:"result-header",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("分析结果")]),r("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-document-copy"},on:{click:e.copyResult}},[e._v(" 复制结果 ")])],1),r("div",{staticClass:"analysis-content"},[r("div",{staticClass:"file-info"},[r("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.form.file?e.form.file.name:""))]),r("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.form.courseName))])],1),r("div",{staticClass:"markdown-content",domProps:{innerHTML:e._s(e.renderedResult)}})])]):e._e(),e.error?r("el-card",{staticClass:"error-card"},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticStyle:{color:"#f56c6c"}},[e._v("分析失败")])]),r("div",{staticClass:"error-content"},[r("i",{staticClass:"el-icon-warning",staticStyle:{color:"#f56c6c","margin-right":"8px"}}),e._v(" "+e._s(e.error)+" ")])]):e._e()],1)},s=[],n=r("c14f"),o=r("1da1"),i=(r("d9e2"),r("caad"),r("af84")),c=r("7c5c"),l={name:"ExamAnalysis",data:function(){return{form:{courseName:"circuit",file:null},fileList:[],loading:!1,result:"",error:""}},computed:{renderedResult:function(){return this.result?c["marked"].parse(this.result,{gfm:!0,breaks:!0,headerIds:!1}):""}},methods:{handleFileChange:function(e){this.form.file=e.raw,this.error=""},beforeUpload:function(e){var t=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type),r=e.size/1024/1024<10;return t?(r||this.$message.error("文件大小不能超过 10MB!"),!1):(this.$message.error("只能上传 Word、PDF 或文本文件!"),!1)},analyzeExam:function(){var e=this;return Object(o["a"])(Object(n["a"])().m((function t(){var r,a,s;return Object(n["a"])().w((function(t){while(1)switch(t.n){case 0:if(e.form.file&&e.form.courseName){t.n=1;break}return e.$message.warning("请选择课程并上传文件"),t.a(2);case 1:return e.loading=!0,e.result="",e.error="",t.p=2,e.$message.info("正在上传文件..."),t.n=3,Object(i["e"])(e.form.file);case 3:if(r=t.v,r){t.n=4;break}throw new Error("文件上传失败");case 4:return e.$message.success("文件上传成功，正在分析..."),t.n=5,Object(i["c"])(r,e.form.courseName);case 5:if(a=t.v,!a.success||!a.text){t.n=6;break}e.result=a.text,e.$message.success("试卷分析完成！"),t.n=7;break;case 6:throw new Error("分析结果为空");case 7:t.n=9;break;case 8:t.p=8,s=t.v,console.error("Analysis failed:",s),e.error="分析失败: ".concat(s.message),e.$message.error("试卷分析失败，请重试");case 9:return t.p=9,e.loading=!1,t.f(9);case 10:return t.a(2)}}),t,null,[[2,8,9,10]])})))()},resetForm:function(){this.form={courseName:"circuit",file:null},this.fileList=[],this.result="",this.error="",this.$refs.upload.clearFiles()},copyResult:function(){var e=this;this.result&&navigator.clipboard.writeText(this.result).then((function(){e.$message.success("分析结果已复制到剪贴板")})).catch((function(){e.$message.error("复制失败，请手动复制")}))}}},u=l,d=(r("167a"),r("2877")),p=Object(d["a"])(u,a,s,!1,null,"08f0d846",null);t["default"]=p.exports},af84:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"e",(function(){return u})),r.d(t,"c",(function(){return p})),r.d(t,"f",(function(){return h})),r.d(t,"d",(function(){return b}));var a=r("c14f"),s=r("b85c"),n=r("1da1");r("d9e2"),r("99af"),r("e9c4"),r("b64b"),r("d3b7"),r("2ca0"),r("498a");function o(e,t){return i.apply(this,arguments)}function i(){return i=Object(n["a"])(Object(a["a"])().m((function e(t,r){var n,o,i,c,l,u,d,p,f,h,m,b,v,w,y,g,_,k,O,j,x,S,T,z,P=arguments;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return n=r.onMessage,o=r.onDone,i=r.onError,c=P.length>2&&void 0!==P[2]?P[2]:"app-J4y46SO9GtwtjADyLAOj9tzL",l="http://101.43.162.190:8088/v1/chat-messages",u={inputs:{},query:t,response_mode:"streaming",user:"user"},d={Authorization:"Bearer ".concat(c),"Content-Type":"application/json"},e.p=1,e.n=2,fetch(l,{method:"POST",headers:d,body:JSON.stringify(u)});case 2:if(p=e.v,p.ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(p.status));case 3:f=p.body.getReader(),h=new TextDecoder("utf-8"),m="";case 4:return e.n=5,f.read();case 5:if(b=e.v,v=b.done,w=b.value,!v){e.n=6;break}return console.log("Stream finished."),o&&o(),e.a(3,17);case 6:y=m+h.decode(w,{stream:!0}),g=y.split("\n"),m=g.pop()||"",_=Object(s["a"])(g),e.p=7,_.s();case 8:if((k=_.n()).done){e.n=13;break}if(O=k.value,O.startsWith("data:")){e.n=9;break}return e.a(3,12);case 9:if(e.p=9,j=O.substring(6),"[DONE]"!==j.trim()){e.n=10;break}return e.a(3,12);case 10:x=JSON.parse(j),"message"===x.event&&x.answer&&n&&n(x.answer),e.n=12;break;case 11:e.p=11,S=e.v,console.error("Failed to parse JSON from line:",O,S);case 12:e.n=8;break;case 13:e.n=15;break;case 14:e.p=14,T=e.v,_.e(T);case 15:return e.p=15,_.f(),e.f(15);case 16:e.n=4;break;case 17:e.n=19;break;case 18:e.p=18,z=e.v,console.error("Streaming failed:",z),i&&i(z);case 19:return e.a(2)}}),e,null,[[9,11],[7,14,15,16],[1,18]])}))),i.apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return l=Object(n["a"])(Object(a["a"])().m((function e(t){var r,s,n,o,i,c,l;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return r="http://101.43.162.190:8088/v1/workflows/run",s="app-n1JVzEVSjlnzr7PXVdzMYtdy",n={inputs:{chapter:t},response_mode:"blocking",user:"lesson-user"},o={Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},e.p=1,e.n=2,fetch(r,{method:"POST",headers:o,body:JSON.stringify(n)});case 2:if(i=e.v,i.ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(i.status));case 3:return e.n=4,i.json();case 4:return c=e.v,e.a(2,c);case 5:throw e.p=5,l=e.v,l;case 6:return e.a(2)}}),e,null,[[1,5]])}))),l.apply(this,arguments)}function u(e){return d.apply(this,arguments)}function d(){return d=Object(n["a"])(Object(a["a"])().m((function e(t){var r,s,n,o,i,c,l,u=arguments;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:"app-bS8Qyzd7klGSkVvhbc2rlBs3",s="http://101.43.162.190:8088/v1/files/upload",n={Authorization:"Bearer ".concat(r)},o=new FormData,o.append("file",t),o.append("user","abc-123"),e.p=1,e.n=2,fetch(s,{method:"POST",headers:n,body:o});case 2:if(i=e.v,i.ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(i.status));case 3:return e.n=4,i.json();case 4:return c=e.v,e.a(2,c.id);case 5:throw e.p=5,l=e.v,console.error("File upload failed:",l),l;case 6:return e.a(2)}}),e,null,[[1,5]])}))),d.apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return f=Object(n["a"])(Object(a["a"])().m((function e(t){var r,s,n,o,i,c,l,u,d,p=arguments;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:"circuit",s=p.length>2&&void 0!==p[2]?p[2]:"app-bS8Qyzd7klGSkVvhbc2rlBs3",n="http://101.43.162.190:8088/v1/workflows/run",o={inputs:{courseName:r,examFile:{type:"document",transfer_method:"local_file",upload_file_id:t}},response_mode:"blocking",user:"abc-124"},i={Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},e.p=1,e.n=2,fetch(n,{method:"POST",headers:i,body:JSON.stringify(o)});case 2:if(c=e.v,c.ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(c.status));case 3:return e.n=4,c.json();case 4:return l=e.v,u="",l.data&&l.data.workflow_run_id&&l.data.workflow_run_id.outputs?u=l.data.workflow_run_id.outputs.text||"":l.data&&l.data.outputs?u=l.data.outputs.text||"":l.outputs&&(u=l.outputs.text||""),e.a(2,{success:!0,text:u,rawData:l});case 5:throw e.p=5,d=e.v,console.error("Exam analysis failed:",d),d;case 6:return e.a(2)}}),e,null,[[1,5]])}))),f.apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return m=Object(n["a"])(Object(a["a"])().m((function e(t){var r,s,n,o,i,c,l,u,d,p=arguments;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:"app-PMBbbHxJePSgvz2XPPytjEre",s="http://43.140.245.165:8993/v1/files/upload",n=new FormData,n.append("file",t),n.append("user","zxr"),e.p=1,e.n=2,fetch(s,{method:"POST",headers:{Authorization:"Bearer ".concat(r)},body:n});case 2:if(c=e.v,c.ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(c.status));case 3:return e.n=4,c.json();case 4:if(l=e.v,console.log("Upload response:",l),u=l.id||l.file_id||(null===(o=l.data)||void 0===o?void 0:o.id)||(null===(i=l.data)||void 0===i?void 0:i.file_id)||"",u){e.n=5;break}throw console.error("Upload response data:",l),new Error("上传失败：未返回文件ID");case 5:return e.a(2,u);case 6:throw e.p=6,d=e.v,console.error("Resume file upload failed:",d),d;case 7:return e.a(2)}}),e,null,[[1,6]])}))),m.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=Object(n["a"])(Object(a["a"])().m((function e(t,r){var s,n,o,i,c,l,u,d,p,f=arguments;return Object(a["a"])().w((function(e){while(1)switch(e.n){case 0:return s=f.length>2&&void 0!==f[2]?f[2]:"app-PMBbbHxJePSgvz2XPPytjEre",n="http://43.140.245.165:8993/v1/workflows/run",o={inputs:{resume_file:{transfer_method:"local_file",upload_file_id:t,type:"document"},job_description:r},response_mode:"blocking",user:"zxr"},i={Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},e.p=1,console.log("Optimize request payload:",JSON.stringify(o,null,2)),console.log("File ID:",t),e.n=2,fetch(n,{method:"POST",headers:i,body:JSON.stringify(o)});case 2:if(c=e.v,c.ok){e.n=4;break}return e.n=3,c.text();case 3:throw l=e.v,console.error("Optimize error response:",l),new Error("HTTP error! status: ".concat(c.status,", message: ").concat(l));case 4:return e.n=5,c.json();case 5:return u=e.v,d="",u.data&&u.data.workflow_run_id&&u.data.workflow_run_id.outputs?d=u.data.workflow_run_id.outputs.text||u.data.workflow_run_id.outputs.result||"":u.data&&u.data.outputs?d=u.data.outputs.text||u.data.outputs.result||"":u.outputs?d=u.outputs.text||u.outputs.result||"":u.result&&(d=u.result),e.a(2,{success:!0,text:d,rawData:u});case 6:throw e.p=6,p=e.v,console.error("Resume optimization failed:",p),p;case 7:return e.a(2)}}),e,null,[[1,6]])}))),v.apply(this,arguments)}}}]);